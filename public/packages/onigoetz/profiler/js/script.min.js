/*! onigoetz_profiler 2013-06-30 */
Profiler={panels:{},hideAllTabs:function(){for(var a=document.querySelectorAll("#profiler-container .op-tab"),b=0;b<a.length;++b)Profiler.utils.removeClass(a[b],"op-tab--selected");var c=document.querySelectorAll("#profiler-container .op-panels > div");for(b=0;b<c.length;++b)Profiler.utils.removeClass(c[b],"op-panel--selected")},showHideTab:function(a){var b=document.getElementById("profiler-container");Profiler.utils.hasClass(b,"op-container--hide")&&Profiler.utils.removeClass(b,"op-container--hide"),Profiler.hideAllTabs(),Profiler.utils.addClass(this,"op-tab--selected");var c=this.getAttribute("data-name");Profiler.utils.addClass(document.getElementById("op-panel-"+c),"op-panel--selected");for(var d in Profiler.panels)Profiler.panels.hasOwnProperty(d)&&"function"==typeof Profiler.panels[d].onPanelChange&&Profiler.panels[d].onPanelChange(this,a)},init:function(){var a=document.getElementById("profiler-container"),b=Profiler.utils.query("#profiler-container .op-tabs .close");Profiler.utils.addEvent(b,"click",function(){Profiler.utils.hasClass(a,"op-container--hide")?Profiler.utils.removeClass(a,"op-container--hide"):Profiler.utils.addClass(a,"op-container--hide"),Profiler.hideAllTabs()});for(var c=document.querySelectorAll("#profiler-container .op-tab:not(.close)"),d=0;d<c.length;++d)Profiler.utils.addEvent(c[d],"click",Profiler.showHideTab);for(var e in Profiler.panels)Profiler.panels.hasOwnProperty(e)&&"function"==typeof Profiler.panels[e].onLoad&&Profiler.utils.addEvent(window,"load",Profiler.panels[e].onLoad)}},Profiler.utils={cacheManager:function(){"use strict";var a={};this.get=function(b){return a.hasOwnProperty(b)?a[b]:null},this.set=function(b,c){return a[b]=c,c}},query:function(a){"use strict";var b="SELECTOR: "+a;return Profiler.utils.cache.get(b)||Profiler.utils.cache.set(b,document.querySelector(a))},hasClass:function(a,b){if(a.className)for(var c=a.className.split(" "),d=b.toUpperCase(),e=0;e<c.length;e++)if(c[e].toUpperCase()==d)return!0;return!1},addClass:function(a,b,c){if(a.className){var d=a.className.split(" ");if(c)for(var e=b.toUpperCase(),f=0;f<d.length;f++)d[f].toUpperCase()==e&&(d.splice(f,1),f--);d[d.length]=b,a.className=d.join(" ")}else a.className=b},removeClass:function(a,b){if(a.className){for(var c=a.className.split(" "),d=b.toUpperCase(),e=0;e<c.length;e++)c[e].toUpperCase()==d&&(c.splice(e,1),e--);a.className=c.join(" ")}},addEvent:function(a,b,c){a.attachEvent?(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c])):a.addEventListener(b,c,!1)},fireEvent:function(a,b){var c;return document.createEventObject?(c=document.createEventObject(),a.fireEvent("on"+b,c)):(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0),!a.dispatchEvent(c))}},Profiler.utils.cache=new Profiler.utils.cacheManager,Profiler.panels.bookmarklets={get_js:function(){var a,b,c="",d="",e=document.getElementsByTagName("script");if(e.length>0){for("Netscape"===navigator.appName&&(d="view-source:"),a=0;a<e.length;a++)e[a].src.length&&(b=e[a].src.substring(e[a].src.lastIndexOf("/")+1),c=c+'<li><a href="'+d+e[a].src+'" target="_blank">'+b+"</a></li>");document.getElementById("js_files_container").innerHTML="<ul>"+c+"</ul>"}},get_css:function(){var a,b,c="",d="",e=document.getElementsByTagName("link");if(e.length>0){for("Netscape"===navigator.appName&&(d="view-source:"),a=0;a<e.length;a++)e[a].href.length&&"stylesheet"===e[a].rel&&(b=e[a].href.substring(e[a].href.lastIndexOf("/")+1),c=c+'<li><a href="'+d+e[a].href+'" target="_blank">'+b+"</a></li>");document.getElementById("css_files_container").innerHTML="<ul>"+c+"</ul>"}},onLoad:function(){Profiler.panels.bookmarklets.get_css(),Profiler.panels.bookmarklets.get_js()}},Profiler.panels.speed={canvasManagerInstance:null,CanvasManager:function(a,b,c){"use strict";function d(a){return"__section__.child"===a.name}function e(a){return"section"===a.category}function f(){return Profiler.utils.query("#op-panel-time h2").clientWidth}var g=c,h="sf2/profiler/timeline",i=1,j=a;this.drawOne=function(a,b,c,f){var h,i,j,k="timeline_"+a.id,l=32,m=g,n=10,o=(f-2*n)/b,p=n,q=a.left*o+n,r=Profiler.utils.cache.get(k)||Profiler.utils.cache.set(k,document.getElementById(k)),s=r.getContext("2d"),t=a.events.filter(function(a){return a.duration>=c}),u="undefined"==window.devicePixelRatio?1:window.devicePixelRatio;"undefined"==s.webkitBackingStorePixelRatio?1:s.webkitBackingStorePixelRatio;var v=u/1,w=l*t.length;r.width=f*v,r.height=w*v,r.style.width=f+"px",r.style.height=w+"px",s.translate(.5,.5),s.scale(v,v),s.textBaseline="middle",s.lineWidth=0,s.strokeStyle="#dfdfdf",t.forEach(function(a){a.periods.forEach(function(b){var c=q+b.start*o;if(d(a))s.fillStyle=m.child_sections,s.fillRect(c,0,(b.end-b.start)*o,w);else if(e(a)){var f=q+b.end*o;s.beginPath(),s.moveTo(c,0),s.lineTo(c,w),s.moveTo(f,0),s.lineTo(f,w),s.fill(),s.closePath(),s.stroke()}})});var x=t.filter(function(a){return!d(a)});x.forEach(function(a){p+=7,a.periods.forEach(function(b){s.fillStyle=s.strokeStyle=m["default"],m[a.name]?s.fillStyle=s.strokeStyle=m[a.name]:m[a.category]&&(s.fillStyle=s.strokeStyle=m[a.category]);var c=q+b.start*o;if(e(a)){var d=q+b.end*o;s.beginPath(),s.moveTo(c,p),s.lineTo(c,p+11),s.lineTo(c+8,p),s.lineTo(c,p),s.fill(),s.closePath(),s.stroke(),s.beginPath(),s.moveTo(d,p),s.lineTo(d,p+11),s.lineTo(d-8,p),s.lineTo(d,p),s.fill(),s.closePath(),s.stroke(),s.beginPath(),s.moveTo(c,p),s.lineTo(d,p),s.lineTo(d,p+2),s.lineTo(c,p+2),s.lineTo(c,p),s.fill(),s.closePath(),s.stroke()}else s.fillRect(c,p+3,2,6),s.fillRect(c,p+.5,(b.end-b.start)*o||2,5)}),p+=25,s.beginPath(),s.strokeStyle="#dfdfdf",s.moveTo(0,p-10),s.lineTo(f,p-10),s.closePath(),s.stroke()}),p=n;var y="12px sans-serif",z="10px sans-serif";x.forEach(function(a){s.fillStyle="#444",s.font=y,h=a.name,i=" ~ "+(a.duration<1?a.duration:parseInt(a.duration,10))+" ms / ~ "+a.memory+" MB",q+a.starttime*o+s.measureText(h+i).width>f?(s.textAlign="end",s.font=z,j=q+a.endtime*o-1,s.fillText(i,j,p),j-=s.measureText(i).width,s.font=y,s.fillText(h,j,p)):(s.textAlign="start",s.font=y,j=q+a.starttime*o+1,s.fillText(h,j,p),j+=s.measureText(h).width,s.font=z,s.fillText(i,j,p)),p+=l})},this.drawAll=function(a,c){a=a||f(),c=c||this.getThreshold();var d=this;j.forEach(function(e){d.drawOne(e,b,c,a)})},this.getThreshold=function(){var a=localStorage.getItem(h+"/threshold");return null===a?i:i=parseInt(a,10)},this.setThreshold=function(a){return i=a,localStorage.setItem(h+"/threshold",a),this}},onResizeAndSubmit:function(a){a.preventDefault(),Profiler.panels.speed.canvasManagerInstance.drawAll()},onThresholdChange:function(){Profiler.panels.speed.canvasManagerInstance.setThreshold(Profiler.utils.query('input[name="threshold"]').value).drawAll()},onLoad:function(){void 0!==window.onigoetz_profiler&&Profiler.panels.speed.init(window.onigoetz_profiler.requests_data,window.onigoetz_profiler.colors)},onPanelChange:function(a,b){Profiler.utils.hasClass(a,"time")&&Profiler.panels.speed.onResizeAndSubmit(b)},init:function(a,b){var c=new Profiler.panels.speed.CanvasManager(a.requests,a.max,b);Profiler.panels.speed.canvasManagerInstance=c,Profiler.utils.query('input[name="threshold"]').value=c.getThreshold(),c.drawAll();for(var d=document.querySelectorAll("#op-panel-time .legends > span[data-color]"),e=0;e<d.length;++e){var f=d[e];f.style.borderLeftColor=f.getAttribute("data-color")}var g=Profiler.utils.query("#timeline-control"),h=Profiler.utils.query('input[name="threshold"]');g.onsubmit=window.onresize=Profiler.panels.speed.onResizeAndSubmit,h.onclick=h.onchange=h.onkeyup=Profiler.panels.speed.onThresholdChange}},Profiler.init();